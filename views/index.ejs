<html>
<head>
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,initial-scale=1.0,user-scalable=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
          crossorigin="anonymous">
    <link href="/stylesheets/style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
            crossorigin="anonymous"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/vue/3.2.47/vue.global.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/qs/6.11.1/qs.min.js"></script>
    <script src="/javascripts/global.js" type="text/javascript"></script>
</head>
<body>
<div class="container" id="app">
    <div class="select-panel row p-2 position-relative border-bottom">
        <div class="col osition-relative cursor-pointer">
            <span class="d-flex align-items-center" @click="toggleNavShow(0)">位置<em class="triangeld"
                                                                                      :class="{active: showNavConfig[0]}"></em></span>
        </div>
        <div class="click-show-part row position-absolute w-100 top-100" :class="{'d-none': !showNavConfig[0]}">
            <ul class="list-group col-5 pe-0">
                <li @click="curProvince = item.value"
                    class="list-group-item border-0 cursor-pointer"
                    :class="{'list-group-item-success': curProvince === item.value}"
                    v-for="(item, index) in globalData.cities" :key="item.value">
                    {{item.label}}
                </li>
            </ul>
            <ul class="list-group col-7 pe-0">
                <li @click="selectCurCity(item)"
                    class="list-group-item border-0 cursor-pointer"
                    :class="{'list-group-item-success': curCity === item.value}"
                    v-for="(item, index) in globalData.cities.find(item => item.value === curProvince).children"
                    :key="item.value">
                    {{item.label}}
                </li>
            </ul>
        </div>
        <div class="col position-relative cursor-pointer">
            <span class="d-flex align-items-center" @click="toggleNavShow(1)">租金<em class="triangeld"
                                                                                      :class="{active: showNavConfig[1]}"></em></span>
        </div>
        <div class=" click-show-part position-absolute start-0 top-100" :class="{'d-none': !showNavConfig[1]}">
            <ul class="list-group col">
                <li @click="selectCurPrice(item)"
                    class="list-group-item border-0 cursor-pointer"
                    :class="{'list-group-item-success': rentMoneyValue === item.value}"
                    v-for="(item, index) in globalData.rentMoneys" :key="item.value">
                    {{item.label}}
                </li>
            </ul>
        </div>
        <div class="col position-relative cursor-pointer">
            <span class="d-flex align-items-center" @click="toggleNavShow(2)">类型<em class="triangeld"
                                                                                      :class="{active: showNavConfig[2]}"></em></span>
        </div>
        <div class=" click-show-part position-absolute start-0 top-100" :class="{'d-none': !showNavConfig[2]}">
            <ul class="list-group col">
                <li @click="selectCurRentType(item)"
                    class="list-group-item  border-0 cursor-pointer"
                    :class="{'list-group-item-success': rentTypeValue === item.value}"
                    v-for="(item, index) in globalData.rentTypes" :key="item.value">
                    {{item.label}}
                </li>
            </ul>
        </div>
        <div class="col position-relative cursor-pointer">
            <span class="d-flex align-items-center" @click="toggleNavShow(3)">户型<em class="triangeld"
                                                                                      :class="{active: showNavConfig[3]}"></em></span>
        </div>
        <div class=" click-show-part position-absolute start-0 top-100" :class="{'d-none': !showNavConfig[3]}">
            <ul class="list-group col">
                <li @click="selectCurHouseType(item)"
                    class="list-group-item border-0 cursor-pointer"
                    :class="{'list-group-item-success': houseTypeValue === item.value}"
                    v-for="(item, index) in globalData.houseTypes" :key="item.value">
                    {{item.label}}
                </li>
            </ul>
        </div>
        <div class="col position-relative cursor-pointer">
            <span class="d-flex align-items-center" @click="toggleNavShow(4)">筛选<em class="triangeld"
                                                                                      :class="{active: showNavConfig[4]}"></em></span>
        </div>
        <div class=" click-show-part position-absolute start-0 top-100 p-3" :class="{'d-none': !showNavConfig[4]}">
            <div class="mb-2" v-for="obj in globalData.filterTypes" :key="obj.label">
                <div class="h6">{{obj.label}}</div>
                <div class="row g-2">
                    <div class="col-3" v-for="(item, index) in obj.list" :key="item.value">
                        <input :type="obj.type" :value="item.value" v-model="filterConfig[obj.model]" class="btn-check"
                               :id="obj.model + String(index)"
                               autocomplete="off">
                        <label class="btn btn-outline-success p-1 w-100 text-nowrap"
                               :for="obj.model + String(index)">{{item.label}}</label>
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-center pt-2">
                <button class="btn btn-secondary w-25 me-3">重置</button>
                <button class="btn btn-success w-25 ms-3">确定</button>
            </div>
        </div>
    </div>
    <div class="list-panel">
        <% for (const item of rentList) { %>
            <div class="row rent-item-row cursor-pointer align-items-stretch border-bottom p-2">
                <div class="col-4">
                    <img src="<%= item.param.cover; %>" alt="<%= item.title; %>"
                         class="w-100 h-100"/>
                </div>
                <div class="col-8">
                    <div class="ellipsis-text"><%= item.title; %></div>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="fs-7 text-secondary">
                            <span><%= item.room; %>室/</span>
                            <span><%= item.square; %>平米/</span>
                            <span><%= item.decoration_type; %></span>
                        </div>
                        <div class="text-danger"><%= item.price; %><%= item.price_text; %>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-success text-nowrap ellipsis-text w-75 fs-7">
                            <% for (const tag of item.param.tag_list) { %>
                                <span class="me-1"><%= tag %></span>
                            <% } %>
                        </div>
                        <span class="text-secondary"><%= item.dateline.toLocaleDateString(); %></span>
                    </div>
                </div>
            </div>
        <% } %>
    </div>
</div>
<script>
    Vue.createApp({
        data() {
            return {
                globalData,
                curProvince: '0',
                curCity: '1.1',
                rentMoneyValue: "",
                rentTypeValue: '',
                houseTypeValue: '',
                showNavConfig: {},
                filterConfig: {}
            }
        },
        created() {
            for (const obj of this.globalData.filterTypes) {
                if (obj.type === "checkbox") {
                    this.filterConfig[obj.model] = []
                }
            }
        },
        methods: {
            toggleNavShow(v) {
                for (const key in this.showNavConfig) {
                    if (String(key) !== String(v)) {
                        this.showNavConfig[key] = false
                    }
                }
                this.showNavConfig[v] = !this.showNavConfig[v]
                console.log(this.showNavConfig[v])
            },
            selectCurCity(item) {
                this.curCity = item.value
                this.query('city')
            },
            selectCurPrice(item) {
                this.rentMoneyValue = item.value
                this.query('price')
            },
            selectCurRentType(item) {
                this.rentTypeValue = item.value
                this.query('vice_class')
            },
            selectCurHouseType(item) {
                this.houseTypeValue = item.value
                this.query('room')
            },
            query(type) {
                const q = Qs.parse(location.search.slice(1))
                if (type === "city") {
                    q.city = this.curCity
                }
                if (type === "price") {
                    q.price = this.rentMoneyValue
                }
                if (type === 'vice_class') {
                    q.vice_class = this.rentTypeValue
                }
                if (type === 'room') {
                    q.room = this.houseTypeValue
                }
                window.location.href = window.location.origin + window.location.pathname + "?" + Qs.stringify(q)
            }
        }
    }).mount('#app')
</script>
</body>
</html>